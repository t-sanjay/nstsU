{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static '/assets/NSTS.png' %}"
    />
    <title>NSTS - Registration Form</title>

    <script src="{% static '/js/script.js' %}" type="text/javascript"></script>
    <link rel="stylesheet" href="{% static '/css/styles.css' %}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  </head>
  <body>
    <div class="container-fluid px-1 mx-auto zoom">
      <div class="px-1 mt-5">
        <div class="d-flex justify-content-around flex-row">
          <img
            src="/static/assets/Nobel.png"
            alt=""
            class="imgNobel py-4"
            id="home"
          />
          <h1 class="text-center">
            NSTS - <br />
            Registration
          </h1>
          <img src="/static/assets/NSTS.png" alt="" class="imgNSTS mx-2" />
        </div>
      </div>
      <div class="row d-flex justify-content-center">
        <div class="col-xl-7 col-lg-8 col-md-9 col-11 text-center">
          <div class="card">
            <h4 class="text-center mb-4">
              Enter your details and make the payment to complete the
              registration
            </h4>

            <div class="row justify-content-between text-left">
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >Full Name<span class="text-danger"> *</span></label
                  >
                </div>
                <input
                  type="text"
                  id="fullName"
                  name="fullName"
                  placeholder="Enter your full name"
                  required
                />
              </div>
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >Father's name<span class="text-danger"> *</span></label
                  >
                </div>
                <input
                  type="text"
                  id="fathersName"
                  name="fathersName"
                  placeholder="Enter your Father's name"
                  required
                />
              </div>
            </div>

            <div class="row text-left">
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >Mother's name<span class="text-danger"> *</span></label
                  >
                </div>
                <input
                  type="text"
                  id="mothersName"
                  name="mothersName"
                  placeholder="Enter your Mother's name"
                  required
                />
              </div>
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >School name<span class="text-danger"> *</span></label
                  >
                </div>
                <input
                  type="text"
                  id="schoolName"
                  name="schoolName"
                  placeholder="Enter name of your School/College"
                  required
                />
              </div>
            </div>

            <!-- dob & standard -->
            <div class="row text-left">
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3" for="dob"
                    >Select Date Of Birth<span class="text-danger">
                      *</span
                    ></label
                  >
                </div>
                <input
                  type="date"
                  id="dob"
                  name="dob"
                  required
                  onchange="calculateAge()"
                />
              </div>
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label for="standard"
                    >Standard<span class="text-danger"> *</span></label
                  >
                </div>

                <select name="standard" id="standard" required>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="Diploma">Diploma</option>
                </select>
              </div>
            </div>

            <!-- age and email -->

            <div class="row justify-content-between text-left">
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3">Age</label>
                </div>
                <input
                  type="text"
                  id="age"
                  name="age"
                  placeholder=""
                  disabled="true"
                />
              </div>
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >Email<span class="text-danger"> *</span></label
                  >
                </div>
                <input
                  type="email"
                  id="email"
                  name="email"
                  placeholder="example@gmail.com"
                  required
                />
              </div>
            </div>

            <!-- phone number and wa no -->

            <div class="row justify-content-between text-left">
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >Phone Number<span class="text-danger"> *</span></label
                  >
                </div>
                <input
                  type="tel"
                  id="phoneNo"
                  name="phoneNo"
                  pattern="[0-9]{10}"
                  required
                />
              </div>
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >Whatsapp Number<span class="text-danger"> *</span></label
                  >
                </div>
                <input
                  type="tel"
                  pattern="[0-9]{10}"
                  id="waNo"
                  name="waNo"
                  required
                />
              </div>
            </div>

            <div class="row justify-content-between text-left mb-4">
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >Password<span class="text-danger"> *</span></label
                  >
                </div>
                <input type="password" id="password" name="password" required />
              </div>
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="d-flex">
                  <label class="form-control-label px-3"
                    >Address<span class="text-danger"> *</span></label
                  >
                </div>
                <textarea
                  type="tel"
                  id="address"
                  name="address"
                  placeholder=""
                  required
                ></textarea>
              </div>
              <div class="form-group col-sm-6 flex-column d-flex mt-4 px-4">
                <div class="row justify-content-end mt-5">
                  <div class="form-group col-sm-6">
                    <button
                      type="submit"
                      class="btn btn-primary"
                      id="submitBtn"
                    >
                      Save & Pay
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- button -->
          </div>
        </div>
      </div>
    </div>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      function calculateAge() {
        let dob = document.getElementById("dob").value;
        var today = new Date();
        var birthDate = new Date(dob);
        var age = today.getFullYear() - birthDate.getFullYear();
        var m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
          age--;
        }
        document.getElementById("age").value = age;
      }
    </script>

    <script type="module">
      submitBtn.addEventListener("click", makePayment);

      function makePayment() {
        let data = {
          fullName: document.getElementById("fullName").value,
          fathersName: document.getElementById("fathersName").value,
          mothersName: document.getElementById("mothersName").value,
          schoolName: document.getElementById("schoolName").value,
          dob: document.getElementById("dob").value,
          standard: document.getElementById("standard").value,
          age: document.getElementById("age").value,
          email: document.getElementById("email").value,
          phoneNo: document.getElementById("phoneNo").value,
          waNo: document.getElementById("waNo").value,
          address: document.getElementById("address").value,
          password: document.getElementById("password").value,
        };

        let amount;
        switch (data.standard) {
          case "5":
          case "6":
          case "7":
            amount = "27000";
            break;
          case "8":
          case "9":
          case "10":
            amount = "36000";
            break;
          case "11":
          case "12":
          case "Diploma":
            amount = "36000";
            break;
          default:
            break;
        }

        if (
          !(data.phoneNo.length && data.waNo.length == 10) ||
          isNaN(parseInt(data.phoneNo)) ||
          isNaN(parseInt(data.waNo))
        ) {
          alert("Please enter 10 Digit Phone number");
        }
        var emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        if (!emailPattern.test(data.email)) {
          alert("Please enter correct Email Address");
        }
        if (
          !data.fullName ||
          !data.fathersName ||
          !data.mothersName ||
          !data.schoolName ||
          !data.dob ||
          !data.age ||
          !data.standard ||
          !data.phoneNo ||
          !data.waNo ||
          !(data.phoneNo.length && data.waNo.length == 10) ||
          isNaN(parseInt(data.phoneNo)) ||
          isNaN(parseInt(data.waNo)) ||
          !emailPattern.test(data.email)
        ) {
          alert("All the fields are mandatory");
        } else {
          localStorage.setItem("usersData", JSON.stringify(data));

          $.ajax({
            url: "updateamount",
            data: {
              amount: amount,
            },
          }).done(function (response, context) {
            callPayment(response);
          });
        }
      }      

      function callPayment(data) {
        var options = {
          // Enter the Key ID generated from the Dashboard
          key: data.razorpay_merchant_key,

          // Amount is in currency subunits.
          // Default currency is INR. Hence,
          // 50000 refers to 50000 paise
          amount: data.razorpay_amount,
          currency: "INR",
          prefill: {
            name: document.getElementById("fullName").value,
            email: document.getElementById("email").value,
            contact: document.getElementById("phoneNo").value,
          },

          // Your/store name.
          name: "NSTS Exam",

          // Pass the `id` obtained in the response of Step 1
          order_id: data.razorpay_order_id,
          callback_url: data.callback_url,
        };
        var order_id = data.razorpay_order_id;
        // initialise razorpay with the options.
        var rzp1 = new Razorpay(options);

        // add event listener to the payment button.
        rzp1.open();
      }
      
    </script>
  </body>
</html>
